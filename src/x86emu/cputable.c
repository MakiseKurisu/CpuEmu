#include    <windows.h>
#include    "cpu.h"



int WINAPI x000(LPDECODE_STATUS_X86 lpStatus)   //Add
{
    lpStatus->nOpcode = 1;
    switch (lpStatus->lpInstruction[lpStatus->nInstructionSize])
    {
    case 0x00:
    case 0x01:
    case 0x02:
    case 0x03:
        switch (lpStatus->nCpuStatus)
        {
        case CPU_X86_16BITS:
            lpStatus->nAddressingByte = 1;
            break;
        default:
            lpStatus->nImmediate = 4;
        }
        break;
    case 0x04:
        lpStatus->nImmediate = 1;
        break;
    case 0x05:
        switch (lpStatus->nCpuStatus)
        {
        case CPU_X86_16BITS:
            lpStatus->nImmediate = 2;
            break;
        default:
            lpStatus->nImmediate = 4;
        }
        break;
    case 0x00:
    }
}

//Based on Intel® 64 and IA-32 Architectures Software Developer's Manual (June 2013)

BYTE LegacyPrefixMap[256] =
{
    /*
    0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F,
    */
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* 0x00 */
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* 0x10 */
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, /* 0x20 */  /* 26h:ES 2Eh:[CS NBRANCH] */
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, /* 0x30 */  /* 36h:SS 3Eh:[DS BRANCH] */
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* 0x40 */
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* 0x50 */
    0x00, 0x00, 0x00, 0x00, 0x02, 0x02, 0x04, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* 0x60 */  /* 64h:FS 65h:GS 66h:OPERAND_SIZE 67h:ADDRESS_SIZE */
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* 0x70 */
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* 0x80 */
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* 0x90 */
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* 0xA0 */
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* 0xB0 */
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* 0xC0 */
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* 0xD0 */
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* 0xE0 */
    0x01, 0x00, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* 0xF0 */  /* F0h:LOCK F2h:[REPNE REPNZ XACQUIRE] F3h:[REP REPE REPZ XRELEASE] */
};

BYTE EmptyMap[256] =
{
    /*
    0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F,
    */
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* 0x00 */
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* 0x10 */
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* 0x20 */
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* 0x30 */
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* 0x40 */
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* 0x50 */
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* 0x60 */
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* 0x70 */
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* 0x80 */
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* 0x90 */
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* 0xA0 */
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* 0xB0 */
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* 0xC0 */
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* 0xD0 */
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* 0xE0 */
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /* 0xF0 */
};

LPOPCODE OpcodeMap[4][256] =
{
    /*
    0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F,     One-byte Opcode Map
    */
    x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, NULL, /* 0x00 */
    x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, /* 0x10 */
    x000, x000, x000, x000, x000, x000, NULL, x000, x000, x000, x000, x000, x000, x000, NULL, x000, /* 0x20 */
    x000, x000, x000, x000, x000, x000, NULL, x000, x000, x000, x000, x000, x000, x000, NULL, x000, /* 0x30 */
    x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, /* 0x40 */
    x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, /* 0x50 */
    x000, x000, x000, x000, NULL, NULL, NULL, NULL, x000, x000, x000, x000, x000, x000, x000, x000, /* 0x60 */
    x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, /* 0x70 */
    x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, /* 0x80 */
    x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, /* 0x90 */
    x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, /* 0xA0 */
    x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, /* 0xB0 */
    x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, /* 0xC0 */
    x000, x000, x000, x000, x000, x000, NULL, x000, x000, x000, x000, x000, x000, x000, x000, x000, /* 0xD0 */
    x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, /* 0xE0 */
    NULL, NULL, NULL, NULL, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, /* 0xF0 */

    /*
    0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F,     Two-byte Opcode Map (First Byte is 0FH)
    */
    x000, x000, x000, x000, NULL, x000, x000, x000, x000, x000, NULL, x000, NULL, x000, NULL, NULL, /* 0x00 */
    x000, x000, x000, x000, x000, x000, x000, x000, x000, NULL, NULL, NULL, NULL, NULL, NULL, x000, /* 0x10 */
    x000, x000, x000, x000, NULL, NULL, NULL, NULL, x000, x000, x000, x000, x000, x000, x000, x000, /* 0x20 */
    x000, x000, x000, x000, x000, x000, NULL, x000, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, /* 0x30 */
    x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, /* 0x40 */
    x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, /* 0x50 */
    x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, /* 0x60 */
    x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, NULL, NULL, x000, x000, x000, x000, /* 0x70 */
    x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, /* 0x80 */
    x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, /* 0x90 */
    x000, x000, x000, x000, x000, x000, NULL, NULL, x000, x000, x000, x000, x000, x000, x000, x000, /* 0xA0 */
    x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, /* 0xB0 */
    x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, /* 0xC0 */
    x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, /* 0xD0 */
    x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, /* 0xE0 */
    x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, NULL, /* 0xF0 */

    /*
    0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F,     Three-byte Opcode Map (First Two Bytes are 0F 38H)
    */
    x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, /* 0x00 */
    x000, NULL, NULL, x000, x000, x000, x000, x000, x000, x000, x000, NULL, x000, x000, x000, NULL, /* 0x10 */
    x000, x000, x000, x000, x000, x000, NULL, NULL, x000, x000, x000, x000, x000, x000, x000, x000, /* 0x20 */
    x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, /* 0x30 */
    x000, x000, NULL, NULL, NULL, x000, x000, x000, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, /* 0x40 */
    NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, x000, x000, x000, NULL, NULL, NULL, NULL, NULL, /* 0x50 */
    NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, /* 0x60 */
    NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, x000, x000, NULL, NULL, NULL, NULL, NULL, NULL, /* 0x70 */
    x000, x000, x000, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, x000, NULL, x000, NULL, /* 0x80 */
    x000, x000, x000, x000, NULL, NULL, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, /* 0x90 */
    NULL, NULL, NULL, NULL, NULL, NULL, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, /* 0xA0 */
    NULL, NULL, NULL, NULL, NULL, NULL, x000, x000, x000, x000, x000, x000, x000, x000, x000, x000, /* 0xB0 */
    NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, /* 0xC0 */
    NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, x000, x000, x000, x000, x000, /* 0xD0 */
    NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, /* 0xE0 */
    x000, x000, x000, x000, NULL, x000, x000, x000, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, /* 0xF0 */

    /*
    0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F,     Three-byte Opcode Map (First two bytes are 0F 3AH)
    */
    x000, x000, x000, NULL, x000, x000, x000, NULL, x000, x000, x000, x000, x000, x000, x000, x000, /* 0x00 */
    NULL, NULL, NULL, NULL, x000, x000, x000, x000, x000, x000, NULL, NULL, NULL, x000, NULL, NULL, /* 0x10 */
    x000, x000, x000, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, /* 0x20 */
    NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, x000, x000, NULL, NULL, NULL, NULL, NULL, NULL, /* 0x30 */
    x000, x000, x000, NULL, x000, NULL, x000, NULL, NULL, NULL, x000, x000, x000, NULL, NULL, NULL, /* 0x40 */
    NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, /* 0x50 */
    x000, x000, x000, x000, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, /* 0x60 */
    NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, /* 0x70 */
    NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, /* 0x80 */
    NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, /* 0x90 */
    NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, /* 0xA0 */
    NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, /* 0xB0 */
    NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, /* 0xC0 */
    NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, x000, /* 0xD0 */
    NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, /* 0xE0 */
    x000, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, /* 0xF0 */
};